## プロジェクト概要

このプロジェクトは、ユーザーが指定した主要都市に基づいて天気情報をLINEを通じて通知するLINE BOTの開発を目的としています。気象庁（JMA）が提供する天気予報データを活用し、シンプルで効率的な天気情報通知システムを構築します。

## 機能概要

- 天気通知機能: ユーザーが選択した主要都市の天気情報をLINEで通知する。
- ユーザー認証: LINEアカウント情報を利用したユーザー認証。
- 通知スケジュール管理: ユーザーごとに通知の時刻と都市を設定し、指定した時間に天気情報を送信。 
- 都市選択機能: ユーザーが初回設定時に主要都市を選択し、後から変更可能。

## 技術スタック
- 言語・フレームワーク：Go、Echo
- データベース：PostgreSQL
- コンテナオーケストレーション：Kubernetes、Helm
- CI/CD：GitHub Actions、ArgoCD
- LINE連携: LINE messaging API


## 詳細設計

1. 天気通知機能

機能概要

ユーザーが選択した主要都市に基づき、天気情報をLINEで通知する機能です。基本的には雨の時のみ通知します。

データ取得

- 気象庁APIの活用:
- 主要都市のlocation_idを事前に確認し、定期的に天気情報を取得します。
- APIのレスポンスデータを解析し、天気と日付を抽出します。
- APIの効率的な利用:
- CronJobを使用して1時間おきに全主要都市の天気情報を取得し、キャッシュに保存します。
- キャッシュを利用することで、ユーザーリクエスト時にリアルタイムでAPIを呼び出す必要を減らし、システムの効率を向上させます。

メッセージフォーマット

- LINE Messaging APIの利用:
- リッチメニューやテンプレートメッセージを活用して、視覚的にわかりやすい天気情報を提供します。
- メッセージの内容やレイアウトをユーザーの設定に応じてカスタマイズ可能にします。

2. ユーザー認証

機能概要

LINEアカウント情報を利用してユーザー認証を行い、個別の設定や通知を管理します。

実装のポイント

認証フロー

- LINE Loginの利用:
- ユーザーがLINEアカウントを友だち追加する際に取得できるユーザーIDを使用します。

アクセストークンの管理

- アクセストークンの安全な保存:
- LINEから取得したアクセストークンを安全に保存・管理します。
- トークンの有効期限を監視し、必要に応じてリフレッシュトークンを使用して更新します。

ユーザーデータの管理

- データベース設計:
- ユーザー情報（LINEのユーザーID、アクセストークン、設定情報など）をPostgreSQLに保存します。
- セキュリティを考慮し、個人情報は暗号化して保存します。
- プライバシーとセキュリティ:
- データベースへのアクセス制御や暗号化を徹底します。

3. 通知スケジュール管理

機能概要

ユーザーごとに通知の時刻と都市を設定し、指定した時間に天気情報を送信します。

実装のポイント

スケジューリングシステム

- ジョブスケジューラーの選定:
- CronJob: 主要都市の天気情報を定期的に取得し、キャッシュを更新します。
- 通常のJob: ユーザーごとの通知ジョブを管理し、指定された時間に天気情報を送信します。
- スケジュールの動的管理:
- ユーザーが通知時間や都市を変更した際に、スケジュールを動的に更新できる仕組みを構築します。

データ管理

- 通知設定の保存:
- ユーザーごとの通知時刻、都市の設定をデータベースに保存します。
- スケジュールジョブをトリガーするための情報も含めます。

タイムゾーンの考慮
- 基本的に日本国内を対象とします。
- すべてのユーザーのタイムゾーンを日本標準時（JST）に統一します。

4. 主要都市の天気情報管理

機能概要

主要都市の天気情報を事前に取得し、ユーザーが選択できるようにします。

データ取得の自動化

- CronJobの設定:
	- Kubernetes CronJobを設定し、定期的に天気情報を取得するジョブを実行します。
- キャッシュの活用:
	- 取得した天気情報をRedisにキャッシュし、ユーザーリクエスト時に迅速に提供できるようにします。

ユーザーインターフェースの調整

- 都市選択のUI:
	- 初回設定時にユーザーに主要都市を選択させるインターフェースを提供します。

5. キャッシュ戦略

キャッシュのタイミング

- CronJobによる定期取得:
- Kubernetes CronJobを使用して、主要都市の天気情報を1時間おきに取得し、Redisにキャッシュします。

キャッシュの有効期限

- 天気情報の有効期限を1時間に設定し、CronJobで定期的に更新します。これにより、データの鮮度を維持しつつ、キャッシュの有効期限を適切に管理します。
